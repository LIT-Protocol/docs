---
description: Learn how to use a PKP to generate Session Signatures
sidebar_label: Using a PKP
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Using a PKP to Generate Session Signatures

:::info
Session Signatures are used by the Lit network to authenticate you and verify your authorization to access requested Lit Resources. They are required when making network requests to sign with a PKP, decrypt data, and execute Lit Actions.

To learn more about Session Signatures, please go [here](../../../learn/authentication/session-sigs).
:::

This guide will demonstrate how to use a PKP (Programmable Key Pair) to generate Session Signatures.

Typically, Session Signatures are generated using an [Authentication Signature generated by an Ethereum wallet](./using-auth-sig). However, there may be scenarios where an Ethereum wallet is either unavailable or not preferred for authentication. In such cases, alternative Authentication Methods can be utilized, such as Google or Discord OAuth, JWTs, or even a custom authentication method using a Lit Action.

In order to do this, we will use a PKP to generate the Authentication Signature that's required by the Lit protocol to authorize a Session and generate Session Signatures.

:::info
The full implementation of the code used in this guide can be found [here](https://github.com/LIT-Protocol/developer-guides-code/tree/wyatt/v2/session-signatures/generating-a-session/using-pkp).
:::

## Prerequisites

- An Ethereum wallet
- An understanding of:
  - [Authentication Methods](../../../learn/authentication/auth-methods)
  - [PKPs](../../../learn/signing-data/pkps)
  - [Authentication Signatures](../../../learn/authentication/auth-sigs)
  - [Session Signatures](../../../learn/authentication/session-sigs)
  - [Lit Resources and Abilities](../../../learn/authentication/lit-resources-and-abilities)

### Required Packages

- `@lit-protocol/constants`
- `@lit-protocol/lit-node-client`
- `@lit-protocol/lit-auth-client`
- `@lit-protocol/auth-helpers`
- `ethers@v5`

<Tabs
defaultValue="npm"
values={[
{label: 'npm', value: 'npm'},
{label: 'yarn', value: 'yarn'},
]}>
<TabItem value="npm">

```bash
npm install \
@lit-protocol/constants \
@lit-protocol/lit-node-client \
@lit-protocol/lit-auth-client \
@lit-protocol/auth-helpers \
ethers@v5
```

</TabItem>

<TabItem value="yarn">

```bash
yarn add \
@lit-protocol/constants \
@lit-protocol/lit-node-client \
@lit-protocol/lit-auth-client \
@lit-protocol/auth-helpers \
ethers@v5
```

</TabItem>
</Tabs>

## The Code Example

### Initial Setup

1. Instantiate an Ethers.js Wallet
   - A code example is available [here](../../getting-started/authenticating-a-session#creating-an-ethers-signer)
2. Instantiate and connect a `LitNodeClient`
   - A code example is available [here](../../getting-started/connecting-to-lit)

### Authenticating the Ethereum Wallet

In order to generate Session Signatures using a PKP, we first need to prove that we own an Ethereum wallet that is authorized to sign with the PKP. This is done by producing an Authentication Signature with the Ethereum wallet.

This code example makes use of the [EthWalletProvider](https://v7-api-doc-lit-js-sdk.vercel.app/classes/lit_auth_client_src.EthWalletProvider.html) to authenticate the Ethereum wallet. The `authenticate` method will first create an [ERC-5573](https://eips.ethereum.org/EIPS/eip-5573) message and sign it using the provided `signer`. It will then format that Authentication Signature as an _Auth Method_ that can be used in the request to generate PKP Session Signatures.

```ts
import { EthWalletProvider } from '@lit-protocol/lit-auth-client';

const authMethod = await EthWalletProvider.authenticate({
    signer: ethersSigner,
    litNodeClient,
});
```

### Requesting PKP Session Signatures

Next we utilize the [getPkpSessionSigs](https://v7-api-doc-lit-js-sdk.vercel.app/classes/lit_node_client_src.LitNodeClient.html#getPkpSessionSigs) method to request the Lit network to generate PKP Session Signatures. This method requires the following parameters:

- `pkpPublicKey`: The public key of the PKP that will be used to generate Session Signatures
- `authMethods`: The Authentication Signature created in the previous step that proves we own an Ethereum wallet authorized to sign with the PKP
- `resourceAbilityRequests`: The Lit Resources and Abilities we're requesting the Session to be authorized to use
- `expiration`: The date and time at which the Session Signatures expire

```ts
const sessionSignatures = await litNodeClient.getPkpSessionSigs({
    pkpPublicKey: pkp.publicKey!,
    authMethods: [authMethod],
    resourceAbilityRequests: [
        {
            resource: new LitPKPResource('*'),
            ability: LIT_ABILITY.PKPSigning,
        },
    ],
    expiration: new Date(Date.now() + 1000 * 60 * 10).toISOString(), // 10 minutes
});
```

The result of this method is an object containing the Session Signatures from the Lit nodes. These Session Signatures can then be used in subsequent requests to interact with the Lit network.

## Summary

:::info
The full implementation of the code used in this guide can be found [here](https://github.com/LIT-Protocol/developer-guides-code/tree/wyatt/v2/session-signatures/generating-a-session/using-pkp).
:::

This guide demonstrates how a PKP can be used to generate Session Signatures to authorize a Session to use the specified Lit Resources and Abilities.
